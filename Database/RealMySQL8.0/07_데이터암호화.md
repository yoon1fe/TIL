데이터 암호화 기능은 5.7 버전부터 지원되었는데, 처음에는 데이터 파일에 대해서만 암호화 기능을 제공하다가, 8.0부터 리두 로그나 언두 로그, 복제를 위한 바이너리 로그 등도 모두 암호화 기능을 제공하기 시작했다.

데이터 암호화는 보안 감사에서 반드시 언급되는 부분으로, 보안이 중요한 도메인에서는 응용 프로그램에서 한 번, 데이터베이스에서 한 번 하는 이중 암호화를 하기도 한다.



## 7.1 MySQL 서버의 데이터 암호화

MySQL 서버에서는 디스크 입출력 부분에서만 암/복호화 처리를 한다. 즉, InnoDB 스토리지 엔진의 I/O 레이어에서만 데이터의 암/복호화 과정이 진행된다. 때문에 쿼리를 처리하는 과정에서는 데이터의 암호화 여부를 신경쓸 필요가 없다. 이렇게 암호화 기능이 활성화되어 있어도 MySQL 내부와 사용자 입장에서는 아무 차이가 없기 때문에 이러한 암호화 방식을 TDE(Transparent Data Encryption)이라고 한다.

데이터를 디스크에서 읽어 오는 페이지는 복호화되어 InnoDB 버퍼 풀에 적재된다. 그래서 데이터 페이지가 한 번 적재되면 암호화되지 않은 테이블과 동일한 성능을 보인다. 하지만 쿼리가 버퍼 풀에 없는 데이터 페이지를 읽는 경우, 복호화 과정을 거치기 때문에 이에 대한 시간이 더 걸린다. 또한, 디스크로 동기화할 때도 암호화 과정이 필요하기 때문에 이에 대한 시간이 더 걸리게 된다. 하지만 데이터 페이지 저장은 쿼리를 처리하는 스레드가 아닌 MySQL 서버의 백그라운드 스레드가 수행하기 때문에 실제 사용자의 쿼리가 지연되는 것은 아니다.



TDE의 암호화 키 관리는 플러그인 방식으로 제공된다. 커뮤니티 에디션에서는 `keyring_file` 플러그인을 사용할 수 있다.



## 7.3 테이블 암호화

TDE를 사용하는 테이블은 일반적인 테이블 생성 구문에 `ENCRYPTION='Y';`  옵션만 추가로 넣으면 생성된다. MySQL 서버에서 암호화된 테이블만 검색할 때는 `information_schema`의 `TABLES` 뷰를 이용하면 된다. 만약 MySQL 서버의 모든 테이블에 대해 암호화를 적용하고 싶다면 `default_table_encryption` 시스템 변수를 `ON`으로 설정하면 된다.



응용 프로그램에서 직접 암호화해서 저장하는 경우도 있는데, 이럴 경우에는 인덱스의 기능을 10% 활용할 수 없다. 이미 암호화된 값을 기준으로 인덱싱이 되어 있기 때문이다. MySQL 서버의 암호화 기능을 이용하면 인덱스 관련된 작업을 처리한 후에 암호화되어 디스크에 저장되기 때문에 이같은 제약이 없다.



## 7.4 언두 로그 및 리두 로그 암호화

8.0.16 버전부터 `innodb_undo_log_encrypt` 와 `innodb_reado_log_encrypt` 시스템 변수를 이용해 InnoDB 스토리지 엔진의 리두 로그와 언두 로그를 암호화된 상태로 저장할 수 있게 되었다. 모든 로그를 한 번에 암호화 처리할 수 없으므로 평소에는 평문으로 저장하다가 암호화가 활성화되면 그때부터 생성되는 로그들만 암호화해서 저장한다.



## 7.5 바이너리 로그 암호화

바이너리 로그와 로그 파일의 암호화는 디스크에 저장된 파일에 대해서만 이루어지고, MySQL 서버 메모리 내부나 소스 서버와 레플리카 서버 간의 네트워크 구간에서는 암호화하지 않는다.



트랜잭션의 내용을 추적하거나 백업 복구를 위해 암호화된 바이너리 로그를 평문으로 복호화할 일이 자주 있는데, 한 번 바이너리 로그 파일이 암호화되면 바이너리 로그 암호화 키가 없으면 복호화할 수 없다. 그런데 암호화 키는 MySQL 서버만 갖고 있기 때문에 복호화가 불가능하다. 때문에 바이너리 로그 파일의 내용을 보려면 MySQL 서버에 직접 접속해서 가져오는 수 밖에 없다.

