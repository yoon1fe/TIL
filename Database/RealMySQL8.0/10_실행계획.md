옵티마이저가 항상 좋은 실행 계획을 만들어내진 못하기 때문에 DBMS 서버는 사용자가 보완할 수 있도록 `EXPLAIN` 명령으로 옵티마이저가 수립한 실행 계획을 확인할 수 있게 해준다. 실행 계획을 읽고 이해하려면 MySQL 서버가 데이터를 처리하는 로직을 이해해야 한다.



## 10.1 통계 정보

MySQL 서버는 5.7 버전까지는 테이블과 인덱스에 대한 대략적인 정보를 가지고 실행 계획을 수립했다. 하지만 이는 테이블 칼럼의 값들이 실제 어떻게 분포되어 있는지에 대한 정보가 없기 때문에 실행 계획의 정확도가 떨어지는 경우가 많았다. 그래서 8.0 버전부터는 인덱스되지 않은 칼럼들에 대해서도 데이터 분포도를 수집해서 저장하는 **히스토그램** 정보가 도입되었다.



### 테이블 및 인덱스 통계 정보

CBO에서 가장 중요한 것은 통계 정보다. MySQL 서버에서는 다른 DBMS보다 통계 정보의 정확도가 높지 않고 통계 정보가 메모리에 관리되었기 때문에 휘발성이 강했다. 그래서 쿼리의 실행 계획을 수립할 때 실제 테이블의 데이터를 일부 분석해서 통계 정보를 보완해서 사용했다.



#### MySQL 서버의 통계 정보

5.6 버전부터 InnoDB 테이블에 대한 통계 정보를 영구적으로 관리할 수 있도록 개선되었다. `mysql` 테이블의 `innodb_index_stats` 테이블과 `innodb_table_stats` 테이블로 관리할 수 있게 되었다.

특정한 이벤트가 발생하면 자동으로 통계 정보가 갱신되는데, 자주 통계 정보가 갱신되면 응용 프로그램의 쿼리를 인덱스 레인지 스캔으로 잘 처리하던 것을 갑자기 풀 테이블 스캔으로 실행되는 상황이 발생할 수도 있다.



영구적인 통계 정보를 사용한다면 MySQL 서버의 점검이나 사용량이 많지 않은 시간을 이용해 더 정확한 통계 정보를 수집할 수도 있다. 더 정확한 통계 정보를 수집하고자 한다면 `innodb_stats_persistent_sample_pages` 시스템 변수에 높은 값을 설정하면 된다. 이 시스템 변수의 기본값은 20이며, 임의로 20개 페이지만 샘플링해서 분석하고 그 결과를 영구적인 통계 정보 테이블에 저장함을 의미한다. 하지만 이 값을 너무 높이면 통계 정보 수집 시간이 길어지므로 주의해야 한다.



### 히스토그램



#### 히스토그램 정보 수집 및 삭제





#### 히스토그램의 용도





#### 히스토그램과 인덱스







### 코스트 모델





## 10.2 실행 계획 확인



### 실행 계획 출력 포맷



### 쿼리의 실행 시간 확인







## 10.3 실행 계획 분석





