MySQL에서는 사용자 계정을 단순히 아이디뿐만 아니라 해당 사용자가 어느 IP에서 접속하고 있는지도 확인한다. 또한, 8.0 버전부터는 권한을 묶어서 관리하는 역할(Role)의 개념도 도입되었기 때문에 각 사용자의 권한으로 미리 준비된 권한 세트를 부여하는 것도 가능하다.



## 3.1 사용자 식별

MySQL의 사용자는 계정뿐만 아니라 사용자의 접속 지점(클라이언트가 실행된 호스트명이나 도메인 또는 IP 주소)도 계정의 일부가 된다. 참고로 아이디와 IP 주소를 감싸는 백틱(\`) 은 식별자를 감싸는 따옴표 역할을 하는데, 이는 홑따옴표(') 를 쓰기도 한다. `svc_id'@'127.0.0.1` 이렇게 되어 있으면 로컬 호스트에서만 `svc_id` 란 아이디로 접속할 때 사용할 수 있는 계정인 것이다.

모든 외부 컴퓨터에서 접속 가능한 계정을 생성하고 싶다면 호스트 부분을 `%`로 설정하면 된다. 이는 모든 IP 또는 모든 호스트명을 의미한다. 만약 동일한 아이디가 있을 때는 범위가 가장 작은 것을 선택한다. 예를 들어 `svc_id'@'127.0.0.1`과 `svc_id'@'%` 가 있다면 전자의 계정 정보를 이용해 사용자를 인증하게 된다.



## 3.2 사용자 계정 관리

8.0부터 계정은 `SYSTEM_USER` 권한을 갖고 있냐에 따라 **시스템 계정**과 **일반 계정**으로 구분된다. 시스템 계정도 일반 계정과 같이 사용자를 위한, 데이터베이스 서버 관리자를 위한 계정이고, 일반 계정은 응용 프로그램이나 개발자를 위한 계정 정도로 이해하면 된다. 시스템 계정은 시스템 계정과 일반 계정을 생성/삭제 및 변경할 수 있다. 또한, 다음과 같이 DB 서버 관리와 관련된 중요 작업은 시스템 계정으로만 수행할 수 있다.

- 계정 관리
- 다른 세션 또는 그 세션에서 실행 중인 쿼리를 강제 종료
- 스토어드 프로그램 생성 시 `DEFINER`를 타 사용자로 설정

DBA 계정에 `SYSTEM_USER` 권한을 할당하고 일반 사용자에게는 그러지 않기 위해서 이러한 개념이 도입되었다.



5.7 버전까지는 `GRANT` 명령으로 권한의 부여와 동시에 계정 생성이 가능했지만, 8.0 부터는 계정 생성은 `CREATE USER`, 권한 부여는 `GRANT` 명령으로 구분해서 실행하도록 바뀌었다. 계정을 생성할 땐 다음과 같은 여러 옵션을 설정할 수 있다.

- 계정의 인증 방식과 비밀번호
- 비밀번호 관련 옵션(비밀번호 유효 기간, 비밀번호 이력 개수, 비밀번호 재사용 불가 기간)
- 기본 역할
- SSL 옵션
- 계정 잠금 여부



일반적으로 많이 사용되는 옵션을 가진 계정 생성 명령은 다음과 같다.

``` mysql
CREATE USER 'user'@'%'
IDENTIFIED WITH 'mysql_native_password' BY 'password'
REQUIRE NONE
PASSWORD EXPIRE INTERVAL 30 DAY
ACCOUNT UNLOCK
PASSWORD HISTORY DEFAULT
PASSWORD REUSE INTERVAL DEFAULT
PASSWORD REQUIRE CURRENT DEFAULT;
```

- IDENTIFIED WITH: 사용자의 인증 방식과 비밀번호를 설정한다. `IDENTIFIED WITH` 뒤에는 인증 방식을 명시해야 하는데, 기본 인증 방식을 사용하려면 `password` 형식으로 명시하면 된다.
- REQUIRE: MySQL 서버에 접속할 때 암호화된 SSL/TLS 채널을 사용할지 여부를 설정한다.





## 3.3 비밀번호 관리

비밀번호는 유효기간이나 이력 관리를 통한 재사용 금지 기능뿐 아니라, 비밀번호를 쉽게 유추할 수 있는 단어들이 사용되지 않도록 글자의 조합을 강제하거나 금칙어를 설정하는 기능도 있다. 유효성 체크 규칙을 적용하려면 `validate_password` 컴포넌트를 설치해서 이용하면 된다. 컴포넌트는 `MySQL` 서버 프로그램에 내장되어 있기 때문에 `INSTALL COMPONENT` 명령으로 설치하면 된다.

MySQL 서버에는 이중 비밀번호 기능이 있다. 두 개의 비밀번호를 모두 맞게 입력했을 때만 로그인을 허용하는 것이 아니라, 둘 중 하나만 일치하면 로그인되도록 되어있다.



## 3.4 권한(Privilege)

권한은 데이터베이스나 테이블 이외의 객체에 적용되는 권한인 글로벌 권한과 데이터베이스나 테이블을 제어하는 데 필요한 객체 단위의 권한으로 구분된다. 객체 권한은 `GRANT` 명령으로 권한을 부여할 때 반드시 특정 객체를 명시해야 하고, 반대로 글로벌 권한 `GRANT` 명령에서 특정 객체를 명시하면 안된다. 예외적으로 `ALL PRIVILEGES` 는 두 가지 용도 모두 사용될 수 있다.

8.0 버전부터는 동적 권한이 추가되었다. 앞의 두 권한은 정적 권한이라고 하고, 이는 MySQL 서버의 소스코드에 고정적으로 명시되어 있는 권한을 의미하고, 동적 권한은 MySQL 서버가 시작되면서 동적으로 생성하는 권한을 의미한다.



사용자에게 권한을 부여할 때는 `GRANT` 명령을 사용하는데, 문법은 다음과 같다.

``` mysql
GRANT privilege_list ON db.table TO 'user'@'host';
```



8.0부터는 존재하지 않는 사용자에 대해 `GRANT` 명령이 실행되면 에러가 발생하기 때문에 반드시 사용자를 먼저 생성하고 권한을 부여해야 한다. 또한, 글로벌 권한은 특정 DB나 테이블에 부여될 수 없기 때문에 ON 절에는 항상 `*.*`를 사용한다. 여기서 `*.*`는 모든 DB의 모든 오브젝트(테이블과 스토어드 프로시저나 함수 등)을 포함한 MySQL 서버 전체를 의미한다.

테이블의 특정 칼럼에 대해서 부여할 수 있는 권한은 `DELETE`를 제외한 `INSERT`, `UPDATE`, `SELECT` 인데, 각 권한 뒤에 칼럼을 명시하는 형태로 명령어가 이루어져 있다.

이렇게 여러 레벨이나 범위로 권한을 설정할 수 있지만, 테이블이나 칼럼 단위의 권한은 잘 사용하지 않는다. 칼럼 단위의 권한이 하나라도 있으면 나머지 모든 테이블의 모든 칼럼에 대해서도 권한 체크를 하기 때문에 성능에 영향을 미칠 수 있기 때문이다. 때문에 칼럼 단위의 접근 권한이 꼭 필요하다면 `GRANT` 로 권한을 주기보다 테이블에서 권한을 허용하고자 하는 칼럼만으로 별도의 뷰를 만들어 사용하는 방법도 생각해볼 수 있다. 뷰도 하나의 테이블로 인식하기 때문에 뷰의 칼럼에 대해 권한을 체크하지 않고 뷰 자체(테이블)에 대한 권한만 체크하게 된다.



## 3.5 역할(Role)

8.0 버전부터 권한을 묶어서 역할(Role)을 사용할 수 있게 되었다. 실제 서버 내부적으로 역할은 계정과 같은 모습을 하고 있다.

`CREATE ROLE` 명령으로 역할을 정의한다.

``` mysql
CREATE ROLE
	role_emp_read,
	role_emp_write;
```

위의 명령은 빈 껍데기만 있는 역할을 정의한 것이고, `GRANT` 명령으로 각 역할에 대해 실질적인 권한을 부여하면 된다.

``` mysql
GRANT SELECT ON employees.* TO role_emp_read;
GRANT INSERT, UPDATE, DELETE ON employees.* TO role_emp_write;
```



그리고 계정에 역할을 부여하는 작업은 `GRANT` 명령을 통해 진행하면 된다.

``` mysql
GRANT role_emp_read TO reader@'127.0.0.1';
GRANT role_emp_read, role_emp_writer TO writer@'127.0.0.1';
```



추가로 `reader` 계정이 `role_emp_read` 역할을 사용할 수 있게 하려면 `SET ROLE` 명령을 실행해 해당 역할을 활성화해야 한다. 역할이 활성화되면 그 역할을 가진 권한은 사용할 수 있는 상태가 되지만, 계정이 로그아웃됐다가 다시 로그인하면 역할이 활성화되지 않은 상태로 초기화되어버린다. 시스템 변수 `activate_all_roles_on_login` 를 `ON`으로 설정하면 매번 역할을 활성화하지 않아도 된다.